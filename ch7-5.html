<html>
  <head>
    <title>Energy Consumption BY Source</title>
    <meta name="description" content="Practical D3">
    <meta name="author" content="Tarek Amr, @gr33ndata">
  </head>
  <body>
  </body>

  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script type="text/javascript">

// Data source:
// http://www.eia.gov/beta/MER/index.cfm?tbl=T01.03#/?f=A&start=1984&end=2014&charted=1-2-3-5-12 

// Data was saved in CSV file, energy.csv
// Then processed with a python script, energy.py

energy = [{
  'values': [{'y': 11.980905, 'x': 1949}, {'y': 12.347109, 'x': 1950}, {'y': 12.552996, 'x': 1951}, {'y': 11.306479, 'x': 1952}, {'y': 11.372684, 'x': 1953}, {'y': 9.714667, 'x': 1954}, {'y': 11.167259, 'x': 1955}, {'y': 11.349723, 'x': 1956}, {'y': 10.820631, 'x': 1957}, {'y': 9.533287, 'x': 1958}, {'y': 9.518353, 'x': 1959}, {'y': 9.837785, 'x': 1960}, {'y': 9.623351, 'x': 1961}, {'y': 9.906454, 'x': 1962}, {'y': 10.412538, 'x': 1963}, {'y': 10.964385, 'x': 1964}, {'y': 11.580608, 'x': 1965}, {'y': 12.14308, 'x': 1966}, {'y': 11.91375, 'x': 1967}, {'y': 12.330677, 'x': 1968}, {'y': 12.38154, 'x': 1969}, {'y': 12.264528, 'x': 1970}, {'y': 11.598411, 'x': 1971}, {'y': 12.076917, 'x': 1972}, {'y': 12.97149, 'x': 1973}, {'y': 12.662878, 'x': 1974}, {'y': 12.662786, 'x': 1975}, {'y': 13.584067, 'x': 1976}, {'y': 13.922103, 'x': 1977}, {'y': 13.765575, 'x': 1978}, {'y': 15.039586, 'x': 1979}, {'y': 15.422809, 'x': 1980}, {'y': 15.907526, 'x': 1981}, {'y': 15.321581, 'x': 1982}, {'y': 15.894442, 'x': 1983}, {'y': 17.070622, 'x': 1984}, {'y': 17.478428, 'x': 1985}, {'y': 17.260405, 'x': 1986}, {'y': 18.008451, 'x': 1987}, {'y': 18.846312, 'x': 1988}, {'y': 19.069762, 'x': 1989}, {'y': 19.172635, 'x': 1990}, {'y': 18.99167, 'x': 1991}, {'y': 19.122471, 'x': 1992}, {'y': 19.835148, 'x': 1993}, {'y': 19.909463, 'x': 1994}, {'y': 20.088727, 'x': 1995}, {'y': 21.001914, 'x': 1996}, {'y': 21.445411, 'x': 1997}, {'y': 21.655744, 'x': 1998}, {'y': 21.622544, 'x': 1999}, {'y': 22.579528, 'x': 2000}, {'y': 21.914268, 'x': 2001}, {'y': 21.903989, 'x': 2002}, {'y': 22.320928, 'x': 2003}, {'y': 22.466195, 'x': 2004}, {'y': 22.796543, 'x': 2005}, {'y': 22.44716, 'x': 2006}, {'y': 22.749466, 'x': 2007}, {'y': 22.387437, 'x': 2008}, {'y': 19.691205, 'x': 2009}, {'y': 20.833968, 'x': 2010}, {'y': 19.657784, 'x': 2011}, {'y': 17.378234, 'x': 2012}, {'y': 18.038633, 'x': 2013}, {'y': 17.990511, 'x': 2014}], 
  'colour': '#1A202C',
  'name': 'Coal'
}, 
{
  'values': [{'y': 5.145142, 'x': 1949}, {'y': 5.968371, 'x': 1950}, {'y': 7.048518, 'x': 1951}, {'y': 7.549621, 'x': 1952}, {'y': 7.906645, 'x': 1953}, {'y': 8.330202, 'x': 1954}, {'y': 8.997935, 'x': 1955}, {'y': 9.613975, 'x': 1956}, {'y': 10.190753, 'x': 1957}, {'y': 10.663199, 'x': 1958}, {'y': 11.717422, 'x': 1959}, {'y': 12.385366, 'x': 1960}, {'y': 12.926392, 'x': 1961}, {'y': 13.730841, 'x': 1962}, {'y': 14.403306, 'x': 1963}, {'y': 15.28785, 'x': 1964}, {'y': 15.768667, 'x': 1965}, {'y': 16.995332, 'x': 1966}, {'y': 17.944788, 'x': 1967}, {'y': 19.209656, 'x': 1968}, {'y': 20.677984, 'x': 1969}, {'y': 21.794707, 'x': 1970}, {'y': 22.469052, 'x': 1971}, {'y': 22.69819, 'x': 1972}, {'y': 22.512399, 'x': 1973}, {'y': 21.732488, 'x': 1974}, {'y': 19.947883, 'x': 1975}, {'y': 20.345426, 'x': 1976}, {'y': 19.930513, 'x': 1977}, {'y': 20.0004, 'x': 1978}, {'y': 20.665817, 'x': 1979}, {'y': 20.235459, 'x': 1980}, {'y': 19.74731, 'x': 1981}, {'y': 18.356222, 'x': 1982}, {'y': 17.220836, 'x': 1983}, {'y': 18.393613, 'x': 1984}, {'y': 17.703482, 'x': 1985}, {'y': 16.591364, 'x': 1986}, {'y': 17.639801, 'x': 1987}, {'y': 18.448393, 'x': 1988}, {'y': 19.601693, 'x': 1989}, {'y': 19.603167, 'x': 1990}, {'y': 20.032958, 'x': 1991}, {'y': 20.713632, 'x': 1992}, {'y': 21.228902, 'x': 1993}, {'y': 21.728067, 'x': 1994}, {'y': 22.671139, 'x': 1995}, {'y': 23.084647, 'x': 1996}, {'y': 23.222716, 'x': 1997}, {'y': 22.830226, 'x': 1998}, {'y': 22.909227, 'x': 1999}, {'y': 23.823977, 'x': 2000}, {'y': 22.772558, 'x': 2001}, {'y': 23.510081, 'x': 2002}, {'y': 22.830642, 'x': 2003}, {'y': 22.923061, 'x': 2004}, {'y': 22.565364, 'x': 2005}, {'y': 22.238738, 'x': 2006}, {'y': 23.662759, 'x': 2007}, {'y': 23.842953, 'x': 2008}, {'y': 23.41594, 'x': 2009}, {'y': 24.574754, 'x': 2010}, {'y': 24.954539, 'x': 2011}, {'y': 26.088582, 'x': 2012}, {'y': 26.818518, 'x': 2013}, {'y': 27.595046, 'x': 2014}],
  'colour': '#e7ba52',  
  'name': 'Nat. Gas'
}, 
{
  'values': [{'y': 11.882722, 'x': 1949}, {'y': 13.315484, 'x': 1950}, {'y': 14.428043, 'x': 1951}, {'y': 14.955682, 'x': 1952}, {'y': 15.555829, 'x': 1953}, {'y': 15.839176, 'x': 1954}, {'y': 17.254955, 'x': 1955}, {'y': 17.937473, 'x': 1956}, {'y': 17.931667, 'x': 1957}, {'y': 18.526937, 'x': 1958}, {'y': 19.32265, 'x': 1959}, {'y': 19.91923, 'x': 1960}, {'y': 20.216387, 'x': 1961}, {'y': 21.048981, 'x': 1962}, {'y': 21.700828, 'x': 1963}, {'y': 22.301257, 'x': 1964}, {'y': 23.24568, 'x': 1965}, {'y': 24.400523, 'x': 1966}, {'y': 25.283661, 'x': 1967}, {'y': 26.979447, 'x': 1968}, {'y': 28.338336, 'x': 1969}, {'y': 29.520695, 'x': 1970}, {'y': 30.56129, 'x': 1971}, {'y': 32.946738, 'x': 1972}, {'y': 34.837435, 'x': 1973}, {'y': 33.45366, 'x': 1974}, {'y': 32.732323, 'x': 1975}, {'y': 35.177782, 'x': 1976}, {'y': 37.12398, 'x': 1977}, {'y': 37.962821, 'x': 1978}, {'y': 37.122274, 'x': 1979}, {'y': 34.20452, 'x': 1980}, {'y': 31.932206, 'x': 1981}, {'y': 30.232226, 'x': 1982}, {'y': 30.052216, 'x': 1983}, {'y': 31.053237, 'x': 1984}, {'y': 30.924732, 'x': 1985}, {'y': 32.19826, 'x': 1986}, {'y': 32.863733, 'x': 1987}, {'y': 34.222795, 'x': 1988}, {'y': 34.209296, 'x': 1989}, {'y': 33.551623, 'x': 1990}, {'y': 32.846032, 'x': 1991}, {'y': 33.524957, 'x': 1992}, {'y': 33.68724, 'x': 1993}, {'y': 34.557545, 'x': 1994}, {'y': 34.441046, 'x': 1995}, {'y': 35.674967, 'x': 1996}, {'y': 36.15848, 'x': 1997}, {'y': 36.817372, 'x': 1998}, {'y': 37.836036, 'x': 1999}, {'y': 38.265934, 'x': 2000}, {'y': 38.189656, 'x': 2001}, {'y': 38.225566, 'x': 2002}, {'y': 38.789798, 'x': 2003}, {'y': 40.226667, 'x': 2004}, {'y': 40.302834, 'x': 2005}, {'y': 39.823636, 'x': 2006}, {'y': 39.490782, 'x': 2007}, {'y': 36.90682, 'x': 2008}, {'y': 34.95905, 'x': 2009}, {'y': 35.488766, 'x': 2010}, {'y': 34.823508, 'x': 2011}, {'y': 34.015932, 'x': 2012}, {'y': 34.613246, 'x': 2013}, {'y': 34.8811, 'x': 2014}],
  'colour': '#1F7872', 
  'name': 'Petroleum'
}, 
{
  'values': [{'y': 0.0, 'x': 1949}, {'y': 0.0, 'x': 1950}, {'y': 0.0, 'x': 1951}, {'y': 0.0, 'x': 1952}, {'y': 0.0, 'x': 1953}, {'y': 0.0, 'x': 1954}, {'y': 0.0, 'x': 1955}, {'y': 0.0, 'x': 1956}, {'y': 0.000112, 'x': 1957}, {'y': 0.001915, 'x': 1958}, {'y': 0.002187, 'x': 1959}, {'y': 0.006026, 'x': 1960}, {'y': 0.019678, 'x': 1961}, {'y': 0.026394, 'x': 1962}, {'y': 0.038147, 'x': 1963}, {'y': 0.039819, 'x': 1964}, {'y': 0.043164, 'x': 1965}, {'y': 0.064158, 'x': 1966}, {'y': 0.088456, 'x': 1967}, {'y': 0.141534, 'x': 1968}, {'y': 0.153722, 'x': 1969}, {'y': 0.239347, 'x': 1970}, {'y': 0.412939, 'x': 1971}, {'y': 0.583752, 'x': 1972}, {'y': 0.910177, 'x': 1973}, {'y': 1.272083, 'x': 1974}, {'y': 1.899798, 'x': 1975}, {'y': 2.111121, 'x': 1976}, {'y': 2.701762, 'x': 1977}, {'y': 3.024126, 'x': 1978}, {'y': 2.775827, 'x': 1979}, {'y': 2.739169, 'x': 1980}, {'y': 3.007589, 'x': 1981}, {'y': 3.131148, 'x': 1982}, {'y': 3.202549, 'x': 1983}, {'y': 3.552531, 'x': 1984}, {'y': 4.075563, 'x': 1985}, {'y': 4.380109, 'x': 1986}, {'y': 4.753933, 'x': 1987}, {'y': 5.586968, 'x': 1988}, {'y': 5.602161, 'x': 1989}, {'y': 6.10435, 'x': 1990}, {'y': 6.422132, 'x': 1991}, {'y': 6.479206, 'x': 1992}, {'y': 6.410499, 'x': 1993}, {'y': 6.693877, 'x': 1994}, {'y': 7.075436, 'x': 1995}, {'y': 7.086674, 'x': 1996}, {'y': 6.596992, 'x': 1997}, {'y': 7.067809, 'x': 1998}, {'y': 7.610256, 'x': 1999}, {'y': 7.862349, 'x': 2000}, {'y': 8.028853, 'x': 2001}, {'y': 8.145429, 'x': 2002}, {'y': 7.959622, 'x': 2003}, {'y': 8.222774, 'x': 2004}, {'y': 8.16081, 'x': 2005}, {'y': 8.214626, 'x': 2006}, {'y': 8.458589, 'x': 2007}, {'y': 8.426491, 'x': 2008}, {'y': 8.35522, 'x': 2009}, {'y': 8.434433, 'x': 2010}, {'y': 8.268698, 'x': 2011}, {'y': 8.061822, 'x': 2012}, {'y': 8.244433, 'x': 2013}, {'y': 8.328558, 'x': 2014}], 
  'colour': '#D13F31',
  'name': 'Nuclear'
}];


var w= 690, h = 380;
var h_margin = 20, v_margin = 55;


var svg = d3.select('body').append('svg')
    .style("background", "#FFF")
    .attr('width', w+2*h_margin)
    .attr('height', h+2*v_margin);

var colours = d3.scale.category10();

var stack = d3.layout.stack()
              .values(function(d){ 
                return d.values; 
               });


energy_stack = stack(energy);
console.log(energy_stack);

max_y = d3.max( 
  energy_stack[energy_stack.length - 1]["values"],
  function(d){ /** for no stacking, return 5*d.y; */ return d.y0 + d.y; }
)

x_range = energy_stack[0]["values"].filter(function(e,i,a){ 
  return (i == 0 || i == (a.length - 1)) ? true : false ; 
}).map(function(d){
  return d["x"]
});


var x = d3.scale.linear()
          .range([h_margin, w-h_margin])
          .domain(x_range);

var y = d3.scale.linear()
          .range([h-v_margin, v_margin])
          .domain([0, max_y]);

var area = d3.svg.area()
    .interpolate('basis')
    .x(function(d, i) { return x(d.x); })
    .y0(function(d) { /** for no stacking, return y(0);*/ return y(d.y0); })
    .y1(function(d) { /** for no stacking, return y(d.y);*/ return y(d.y0 + d.y); });

svg.selectAll(".layer")
      .data(energy_stack)
      .enter()
      .append("path")
      .attr("class", "layer")
      .attr("d", function(d){ 
        return area(d["values"]); 
      })
      .style("fill", function(d, i){
        return d.colour; 
      })
      .style("opacity", 0.95)
      .attr("stroke", "#FFF")
      .attr("stroke-width", 3);

var textScale = d3.scale.ordinal().domain(energy_stack.map(function(d,i){ return i; })).rangePoints([0.15*w, 0.85*w]);

svg.selectAll("text")
      .data(energy_stack)
      .enter()
      .append("text")
      .attr("x", function(d, i){ 
        return textScale(i); 
      })
      .attr("y", function(d, i){ 
        return h - v_margin/2; 
      })
      .text(function(d){ 
        return d["name"]; 
      })
      .style("text-anchor", "middle")
      .attr("font-size", function(d,i){
        return 22;  
       })
      .style("fill", function(d,i){
        return d["colour"];  
       });

svg.append("text")
      .attr("x", function(d, i){ 
        return w/2; 
      })
      .attr("y", function(d, i){ 
        return v_margin/2; 
      })
      .text(function(d){ 
        return "USA Energy Consumption by Source (1949â€“2014)"; 
      })
      .style("text-anchor", "middle")
      .attr("font-size", function(d,i){
        return 26;  
       })
      .style("fill", function(d,i){
        return "#D13F31";  
       });

  </script>
<html> 
